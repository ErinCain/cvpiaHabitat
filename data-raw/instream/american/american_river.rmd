---
title: "American River"
author: "sadie"
date: "December 11, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
library(tidyverse)
library(readxl)
library(cvpiaHabitat)
library(scales)

```

## Instream Spawning and Rearing Habiat
**Data Source:** FWS 1985 Mark Gard IFIM study + Lower American River Biological Rationale,
Development and Performance of the Modified Flow Management Standard 2017 study TODO

Need link to 1985 FWS study TODO

Modeling description TODO

Mark Gard instructed us to use A35:D46 of the 'American' tab within his 'IFIMWUA.xlsx'
These cells represent the sums of the reaches Sailor Bar, Ancil Hoffman, Watt, 
and H Street divided by 4. The units are sqft/1000ft. 

## Mark Gard Raw Data
```{r}
american_raw <- read_excel('data-raw/mark_gard_data/IFIMWUA.xlsx', range = "A35:D46", sheet = 'American')
american_raw 

```

Chris Hammersmark has provided updated spawning WUA TODO

## Chris Hammersmark New Data
[ARWA-702](https://s3-us-west-2.amazonaws.com/cvpiahabitat-r-package/cvpia-sit-model-inputs/ARWA-702.pdf)    
Fall Run Chinook Spawning: Attachment B, Table B-4 and Figure B-8 on pdf page 91 and 92     
Steelhead Spawning: Attachment B, Table B-9 and Figure B-26 on pdf page 107     
pg 89 table b-3 contains the study reach lengths


### Compare WUA curves old and new
```{r}
spawn <- read_csv('data-raw/instream/american/american_river_spawning_wua.csv')

study_len <- 800+377+1553+522+3142+3103+1000+754+3442+1500

cs <- spawn %>%
  mutate(sqft_per_1000ft = FR_wua_ft2/(study_len/1000)) %>% 
  select(Flow = flow_cfs, Spawning = sqft_per_1000ft) %>% 
  mutate(source = 'Chris')

american_raw %>% 
  select(Flow, Spawning) %>% 
  mutate(source = 'Mark') %>% 
  bind_rows(cs) %>% 
  ggplot(aes(Flow, Spawning, color = source)) +
  geom_line()

```

## Combine Mark Gard and Chris Hammersmark data

heading title change TODO
```{r}
rearing <- american_raw %>% 
  select(-Spawning) %>% 
  gather(lifestage, WUA, -Flow) %>% 
  rename(flow_cfs = Flow)

spawning <- spawn %>%
  mutate(FR_spawn_wua = FR_wua_ft2/(study_len/1000),
         ST_spawn_wua = ST_wua_ft2/(study_len/1000)) %>% 
  select(flow_cfs, FR_spawn_wua, ST_spawn_wua) %>% 
  gather(lifestage, WUA, -flow_cfs)

american_river_instream <- rearing %>% 
  bind_rows(spawning) %>% 
  spread(lifestage, WUA) %>% 
  select(flow_cfs, FR_spawn_wua, FR_fry_wua = `Fry Rearing`, 
         FR_juv_wua = `Juv Rearing`, ST_spawn_wua) %>% 
  mutate(watershed = 'American River')

american_river_instream
# devtools::use_data(american_river_instream, overwrite = TRUE)
```
