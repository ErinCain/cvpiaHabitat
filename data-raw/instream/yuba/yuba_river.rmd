---
title: "Yuba River"
author: "sadie"
date: "December 12, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
library(tidyverse)
library(readxl)
library(cvpiaHabitat)
library(scales)
```


fixing the yuba instream based on Mark Gard Input
according to mark gard, on engle to daguerre segment use 400cfs as the min cfs
then on the dag to feather use linear interpolation to fill in gaps

Englebright to Daguerre Segment (12.7 miles) cells A4:H33
Daguerre to Feather Segment (11.4 miles) cells A39:H68  
units in square feet

```{r}

eng_dag <- read_excel('data-raw/mark_gard_data/IFIMWUA.xlsx', sheet = 'Yuba', range = 'A4:H33',
                      col_names = c('flow', 'SR_spawn', 'FR_spawn', 'ST_spawn', 'FR_fry', 'ST_fry', 'FR_juv', 'ST_juv'))

dag_fea <- read_excel('data-raw/mark_gard_data/IFIMWUA.xlsx', sheet = 'Yuba', range = 'A39:H68',
                      col_names = c('flow', 'SR_spawn', 'FR_spawn', 'ST_spawn', 'FR_fry', 'ST_fry', 'FR_juv', 'ST_juv'))

Flow <- sort(unique(c(eng_dag$flow, dag_fea$flow)))


eng_dag_approx <- tibble(
  flow = Flow,
  SR_spawn_wua = approx(eng_dag$flow, eng_dag$SR_spawn, xout = Flow, rule = 2)$y,
  FR_spawn_wua = approx(eng_dag$flow, eng_dag$FR_spawn, xout = Flow, rule = 2)$y,
  ST_spawn_wua = approx(eng_dag$flow, eng_dag$ST_spawn, xout = Flow, rule = 2)$y,
  FR_fry_wua = approx(eng_dag$flow, eng_dag$FR_fry, xout = Flow, rule = 2)$y,
  ST_fry_wua = approx(eng_dag$flow, eng_dag$ST_fry, xout = Flow, rule = 2)$y,
  FR_juv_wua = approx(eng_dag$flow, eng_dag$FR_juv, xout = Flow, rule = 2)$y,
  ST_juv_wua = approx(eng_dag$flow, eng_dag$ST_juv, xout = Flow, rule = 2)$y,
  mi = 12.7
)

dag_fea_approx <- tibble(
  flow = Flow,
  SR_spawn_wua = approx(dag_fea$flow, dag_fea$SR_spawn, xout = Flow, rule = 2)$y,
  FR_spawn_wua = approx(dag_fea$flow, dag_fea$FR_spawn, xout = Flow, rule = 2)$y,
  ST_spawn_wua = approx(dag_fea$flow, dag_fea$ST_spawn, xout = Flow, rule = 2)$y,
  FR_fry_wua = approx(dag_fea$flow, dag_fea$FR_fry, xout = Flow, rule = 2)$y,
  ST_fry_wua = approx(dag_fea$flow, dag_fea$ST_fry, xout = Flow, rule = 2)$y,
  FR_juv_wua = approx(dag_fea$flow, dag_fea$FR_juv, xout = Flow, rule = 2)$y,
  ST_juv_wua = approx(dag_fea$flow, dag_fea$ST_juv, xout = Flow, rule = 2)$y,
  mi = 11.4
)

tot_study_len = 12.7 + 11.4

eng_dag_approx %>% 
  bind_rows(dag_fea_approx) %>% 
  gather(lifestage, sq_ft, -flow, -mi) %>% 
  group_by(lifestage, flow) %>% 
  summarise(wua = sum(sq_ft/mi/5.28 * mi/tot_study_len)) %>% 
  spread(lifestage, wua) %>% 
  mutate(watershed = 'Yuba River') 
  
```

```{r}




# devtools::use_data(yuba_river_instream, overwrite = TRUE)
```
