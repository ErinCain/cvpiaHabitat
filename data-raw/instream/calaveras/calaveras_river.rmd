---
title: "Calaveras River"
author: "[Sadie Gill](mailto:sgill@flowwest.com), [Mark Tompkins](mailto:mtompkins@flowwest.com), [Erin Cain](mailto:ecain@flowwest.com)"
date: "June 6, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
library(tidyverse)
library(readxl)
library(cvpiaHabitat)
```
## Future Data Improvements
None

## Instream Spawning and Rearing Habitat

**Data Source:** 
[FISHBIO Environmental and Thomas R. Payne & Associates 2009](https://s3-us-west-2.amazonaws.com/cvpiahabitat-r-package/cvpia-sit-model-inputs/FishBio_Payne2009_CalaverasInstreamFlowStudy.pdf) (pgs. 18-19)

Instream spawning and rearing habitat for Steelhead in the Calaveras River is based on data prepared by FISHBIO and Thomas Payne for the Stockton East Water District. FISHBIO and Payne conducted an instream flow study using a Physical Habitat Simulation model on four reaches of the Calaveras River to find a relationship between streamflow and Steelhead habitat. Graphs showing the original data are on pgs. 18-19 of the assessment linked above. The Steelhead instream spawning and rearing habitat data was provided to us by [Mark Gard](mailto:mark_gard@fws.gov) from the U.S. Fish and Wildlife Service in a spreadsheet (see '~/cvpiaHabitat/data-raw/mark_gard_data/IFIMWUA.xlsx'). Mark Gard instructed us to use cells A2:D12 for steelhead rearing in the 'Calaveras' tab within his 'IFIMWUA.xlsx'. 

###Combine Spawning and Rearing Data 
The instream spawning and rearing habitat data described above for Steelhead (ST) is combined for use in the DSM in the following format. Units are in square feet per 1000 feet.

```{r, echo=FALSE}

 calaveras <- read_excel('data-raw/mark_gard_data/IFIMWUA.xlsx', 
                         range = "A2:D12", sheet = 'Calaveras') 
 
 
 calaveras_river_instream <- calaveras %>% 
   mutate(watershed = 'Calaveras River') %>% 
   rename(flow_cfs = Flow, ST_spawn_wua = 'Spawning', ST_fry_wua = `Fry Rearing`,
          ST_juv_wua = `Juv Rearing`)
 
 knitr::kable(head(calaveras_river_instream, 5), align = "c")
 
 #devtools::use_data(calaveras_river_instream, overwrite = TRUE)
```

###### ...with 5 more rows. 

### Spawning WUA 
The instream spawning habitat weighted usable areas for Steelhead in the Calaveras River.

#### Spawning WUA Plot
The following plot shows the weighted usable spawning area in square feet per thousand feet of river for Steelhead. These area per length rates are multiplied by the total spawning reach length mapped by the SIT. 

``` {r,echo=FALSE}
calaveras_river_instream %>% 
    filter(!is.na(ST_spawn_wua)) %>%
    ggplot(aes(x = flow_cfs , y = ST_spawn_wua)) +
    geom_line(color = '#7570b3') +
    labs(x = 'Flow (cfs)', y = 'WUA (sqft/1000ft)')
```

### Rearing WUA
The fry and juvenile instream rearing habitat weighted usable areas for Steelhead in the Calaveras River.  

#### Rearing WUA Plot

The following plot shows the weighted usable rearing area in square feet per thousand feet of river for Steelhead fry and juvenile. These rates are multiplied by the total rearing reach length mapped by the SIT. 
``` {r,echo=FALSE}
calaveras_river_instream %>% 
  gather(Lifestage, wua, -flow_cfs, -watershed)  %>% 
  filter(!is.na(wua), Lifestage != 'ST_spawn_wua', Lifestage != 'ST_adult_wua') %>%
  mutate(Lifestage = ifelse(Lifestage == 'ST_fry_wua', 'Fry', 'Juvenile')) %>% 
  ggplot(aes(x = flow_cfs , y = wua, color = Lifestage)) +
  geom_line() +
  labs(x = 'Flow (cfs)', y = 'WUA (sqft/1000ft)') +
  theme_minimal() + 
  scale_color_manual(values = c('#d95f02','#7570b3'))
```


