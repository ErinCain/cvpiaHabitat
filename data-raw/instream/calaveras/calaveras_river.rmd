---
title: "Calaveras River"
author: "[Sadie Gill](mailto:sgill@flowwest.com), [Mark Tompkins](mailto:mtompkins@flowwest.com), [Erin Cain](mailto:ecain@flowwest.com)"
date: "June 17, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
library(tidyverse)
library(readxl)
library(cvpiaHabitat)
```
## Future Data Improvements
None planned 

## Instream Spawning and Rearing Habitat

**Data Source:** 
[FISHBIO Environmental and Thomas R. Payne & Associates 2009](https://s3-us-west-2.amazonaws.com/cvpiahabitat-r-package/cvpia-sit-model-inputs/FishBio_Payne2009_CalaverasInstreamFlowStudy.pdf) (pgs. 18-19)

No habitat modeling is available for Chinook on the Calaveras River. Instream spawning and rearing habitat for Steelhead in the Calaveras River is used as a proxy for Chinook. This data is based on an instream flow study conducted by FISHBIO and Thomas Payne for the Stockton East Water District. They used a Physical Habitat Simulation model on four reaches to find a relationship between streamflow and suitable Steelhead habitat. Graphs showing the original data are on pgs. 18-19 of the study report linked above. Values from the four reaches were converted to an average weighted by the length of each study reach provide on page 13 of the FISHBIO and Payne report. This approach was developed in coordination with [Mark Gard](mailto:mark_gard@fws.gov) from the U.S. Fish and Wildlife Service and completed in a spreadsheet (see '~/cvpiaHabitat/data-raw/Calaveras_all_reaches.xlsx'). We used cells H2:K12 which give the average weighted WUA for spawning and rearing of Steelhead in the four study reaches.

###Combine Spawning and Rearing Data 
The instream spawning and rearing habitat data described above for Steelhead (ST) is combined for use in the DSM in the following format. Units are in square feet per 1000 feet.
```{r, echo =FALSE}
calaveras <- read_excel('data-raw/Calaveras_all_reaches.xlsx', range = "H2:K12") 

calaveras_river_instream <- calaveras %>% 
   mutate(watershed = 'Calaveras River') %>% 
   rename(flow_cfs = Flow, ST_spawn_wua = 'W Spawning', ST_fry_wua = 'W Fry Rearing',
          ST_juv_wua = 'W Juv Rearing')
 
 knitr::kable(head(calaveras_river_instream, 5), align = "c")
 
 #devtools::use_data(calaveras_river_instream, overwrite = TRUE)
```


```{r, echo=FALSE}
 #comented out because this was the original mark gard data that only included reaches 1 and 2 of the river. I left this in for now because it is the original data that the model is run on and I wanted to make sure we updated it for future use.  

 #calaveras <- read_excel('data-raw/mark_gard_data/IFIMWUA.xlsx', 
 #                        range = "A2:D12", sheet = 'Calaveras') 
 
 #calaveras_river_instream <- calaveras %>% 
 #  mutate(watershed = 'Calaveras River') %>% 
 #  rename(flow_cfs = Flow, ST_spawn_wua = 'Spawning', ST_fry_wua = `Fry Rearing`,
 #         ST_juv_wua = `Juv Rearing`)
 
 #knitr::kable(head(calaveras_river_instream, 5), align = "c")
 
 #devtools::use_data(calaveras_river_instream, overwrite = TRUE)
```

###### ...with 5 more rows. 

### Spawning WUA 
The instream spawning habitat weighted usable areas for Steelhead in the Calaveras River.

#### Spawning WUA Plot
The following plot shows the weighted usable spawning area in square feet per thousand feet of river for Steelhead. These area per length rates are multiplied by the total spawning reach length mapped by the SIT. 

``` {r,echo=FALSE}
calaveras_river_instream %>% 
    filter(!is.na(ST_spawn_wua)) %>%
    ggplot(aes(x = flow_cfs , y = ST_spawn_wua)) +
    geom_line(color = '#7570b3') +
    labs(x = 'Flow (cfs)', y = 'WUA (sqft/1000ft)') +
    theme_minimal()
```

### Rearing WUA
The fry and juvenile instream rearing habitat weighted usable areas for Steelhead in the Calaveras River.  

#### Rearing WUA Plot

The following plot shows the weighted usable rearing area in square feet per thousand feet of river for Steelhead fry and juvenile. These rates are multiplied by the total rearing reach length mapped by the SIT. 
``` {r,echo=FALSE}
calaveras_river_instream %>% 
  gather(Lifestage, wua, -flow_cfs, -watershed)  %>% 
  filter(!is.na(wua), Lifestage != 'ST_spawn_wua') %>%
  mutate(Lifestage = ifelse(Lifestage == 'ST_fry_wua', 'Fry', 'Juvenile')) %>% 
  ggplot(aes(x = flow_cfs , y = wua, color = Lifestage)) +
  geom_line() +
  labs(x = 'Flow (cfs)', y = 'WUA (sqft/1000ft)') +
  theme_minimal() + 
  scale_color_manual(values = c('#d95f02','#7570b3'))
```


