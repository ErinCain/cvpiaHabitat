---
title: "Tuolumne River"
author: "[Sadie Gill](mailto:sgill@flowwest.com), [Mark Tompkins](mailto:mtompkins@flowwest.com)"
date: "July 1, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
library(tidyverse)
library(readxl)
library(cvpiaHabitat)
```

```{r}
source('data-raw/floodplain/floodplain_utils.R')
```

## Floodplain Modeling Details
`r print_model_details('Tuolumne River', 'fr')`

## Floodplain Data
```{r}
tuolumne_fp <- read_excel('data-raw/floodplain/CVPIA_FloodplainAreas.xlsx', 
                                        sheet = 'TuolumneRiver') %>%
  mutate(watershed = 'Tuolumne River',
         SR_floodplain_acres = modeled_floodplain_area_acres,
         ST_floodplain_acres = modeled_floodplain_area_acres) %>%
  select(flow_cfs,
         FR_floodplain_acres = modeled_floodplain_area_acres,
         SR_floodplain_acres, ST_floodplain_acres,
         watershed)

threshold <- tuolumne_fp %>% 
  filter(FR_floodplain_acres == 0) %>% 
  summarise(max = max(flow_cfs)) %>% 
  pull(max)

tuolumne_river_floodplain <- tuolumne_fp %>% 
  filter(flow_cfs >= threshold)

knitr::kable(align = 'c', head(tuolumne_river_floodplain, 5))
# devtools::use_data(tuolumne_river_floodplain, overwrite = TRUE)
```

*...with 28 more rows*

## Floodplain Plot
```{r}
tuolumne_river_floodplain %>% 
  rename(`Fall Run Chinook` = FR_floodplain_acres,
         `Spring Run Chinook` = SR_floodplain_acres,
         `Steelhead` = ST_floodplain_acres) %>% 
  gather(Species, acres, -flow_cfs, -watershed) %>% 
  ggplot(aes(flow_cfs, acres, color = Species)) +
  geom_line() +
  theme_minimal() +
  scale_color_brewer(palette = 'Dark2') +
  labs(x = 'Flow (cfs)', y = 'Total Inundated Acres')
```

